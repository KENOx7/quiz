<!DOCTYPE html>
<html lang="az">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kenoo</title>

  <script src="https://unpkg.com/@dotlottie/player-component@2.7.12/dist/dotlottie-player.mjs" type="module"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
  
  <style>
    :root {
      --bg-gradient-start: #e3f2fd;
      --bg-gradient-end: #ffffff;
      --text-color: #333;
      --card-bg: #ffffff;
      --card-shadow: rgba(0, 0, 0, 0.08);
      --btn-primary-start: #42a5f5;
      --btn-primary-end: #1e88e5;
      --btn-secondary-start: #ffb74d;
      --btn-secondary-end: #ffa726;
      --toast-info-bg: #333;
      --toast-success-bg: #388e3c;
      --toast-error-bg: #d32f2f;
      --toast-warning-bg: #f57c00;
      --toast-text: #fff;
    }
    body.dark {
      --bg-gradient-start: #2c2c2c;
      --bg-gradient-end: #121212;
      --text-color: #f0f0f0;
      --card-bg: #1e1e1e;
      --card-shadow: rgba(0, 0, 0, 0.4);
      --btn-primary-start: #4a90e2;
      --btn-primary-end: #357ab7;
      --btn-secondary-start: #f5a25d;
      --btn-secondary-end: #e07d24;
      --toast-info-bg: #555;
      --toast-success-bg: #4caf50;
      --toast-error-bg: #ff5252;
      --toast-warning-bg: #ff9800;
      --toast-text: #fff;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: "Poppins", Arial, sans-serif;
      background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
      color: var(--text-color);
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
      overflow-x: hidden;
      transition: background 0.4s ease, color 0.4s ease;
      position: relative;
    }

    .skip-link {
      position: absolute; top: -40px; left: 0; background: #000; color: #fff; padding: 8px;
      z-index: 1000; transition: top 0.3s; text-decoration: none; font-size: 0.9rem;
    }
    .skip-link:focus { top: 0; }

    h1 {
      margin-bottom: 20px; font-weight: 600; font-size: 2rem; text-align: center;
      opacity: 0; transform: translateY(-20px); animation: fadeIn 1s ease-out forwards;
    }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }

    #loader {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 255, 255, 0.9);
      display: flex; align-items: center; justify-content: center; z-index: 9999; transition: opacity 0.3s ease;
    }
    #loader.hidden { opacity: 0; pointer-events: none; }
    .spinner {
      width: 50px; height: 50px; border: 6px solid #ddd; border-top: 6px solid var(--btn-primary-start);
      border-radius: 50%; animation: spin 1s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    #container {
      width: 100%; max-width: 600px; background-color: var(--card-bg); border-radius: 12px;
      box-shadow: 0 8px 20px var(--card-shadow); padding: 30px 20px; text-align: center;
      transition: transform 0.3s ease, opacity 0.4s ease; position: relative; opacity: 1;
    }
    #container.hidden { opacity: 0; }
    #container:hover { transform: translateY(-2px); }
    .section-title { font-size: 1.2rem; font-weight: 600; color: var(--text-color); margin-bottom: 16px; }

    .back-btn {
      position: absolute; top: 16px; left: 16px; padding: 8px 14px; border: none; border-radius: 6px;
      background-color: #9e9e9e; color: #fff; cursor: pointer; font-size: 0.9rem; font-weight: 500;
      transition: background 0.3s ease; overflow: hidden;
    }
    .back-btn:hover { background-color: #757575; }
    #container.has-back { padding-top: 50px; }

    .start-btn {
      position: relative; padding: 14px 28px; margin: 8px; border: none; border-radius: 8px;
      background: linear-gradient(135deg, var(--btn-primary-start) 0%, var(--btn-primary-end) 100%);
      color: #fff; cursor: pointer; font-size: 1rem; font-weight: 600;
      transition: background 0.3s ease, box-shadow 0.3s ease, transform 0.2s ease;
      box-shadow: 0 4px 12px rgba(66, 165, 245, 0.4); overflow: hidden;
    }
    .start-btn:hover {
      background: linear-gradient(135deg, var(--btn-primary-end) 0%, #1565c0 100%);
      box-shadow: 0 6px 16px rgba(66, 165, 245, 0.5); transform: scale(1.03);
    }

    #btn-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 12px; margin-top: 20px; }
    .quiz-btn {
      position: relative; padding: 12px 20px; border: none; border-radius: 8px;
      background: linear-gradient(135deg, var(--btn-secondary-start) 0%, var(--btn-secondary-end) 100%);
      color: #fff; cursor: pointer; font-size: 0.95rem; font-weight: 600;
      transition: background 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease, opacity 0.4s ease;
      box-shadow: 0 4px 12px rgba(255, 183, 77, 0.4); text-align: center; opacity: 0;
      animation: slideDown 0.5s forwards ease-out;
    }
    .quiz-btn:nth-child(1) { animation-delay: 0.2s; }
    .quiz-btn:nth-child(2) { animation-delay: 0.35s; }
    .quiz-btn:nth-child(3) { animation-delay: 0.5s; }
    .quiz-btn:nth-child(4) { animation-delay: 0.65s; }
    @keyframes slideDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
    .quiz-btn:hover {
      background: linear-gradient(135deg, var(--btn-secondary-end) 0%, #fb8c00 100%);
      transform: translateY(-3px) scale(1.02); box-shadow: 0 6px 16px rgba(255, 183, 77, 0.5);
    }

    .ripple {
      position: absolute; border-radius: 50%; background: rgba(255, 255, 255, 0.6);
      transform: scale(0); animation: rippleEffect 0.6s linear;
    }
    @keyframes rippleEffect { to { transform: scale(4); opacity: 0; } }

    iframe.fullscreen-quiz {
      width: 100%; height: 60vh; border: none; border-radius: 12px; margin-top: 24px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1); position: fixed; top: 0; left: 0; height: 100vh; z-index: 10000; margin:0;
    }

    .modal-overlay {
      position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background-color: rgba(0, 0, 0, 0.5);
      z-index: 10000; display: flex; align-items: center; justify-content: center;
    }
    .modal-content {
      position: relative; width: 90vw; height: 90vh; background: var(--card-bg);
      border-radius: 12px; overflow: hidden; box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
    }
    .modal-content iframe { width: 100%; height: 100%; border: none; }
    .close-modal {
      position: absolute; top: 8px; right: 8px; background: #e0e0e0; border: none; border-radius: 50%;
      width: 32px; height: 32px; font-size: 1.2rem; cursor: pointer; z-index: 10001;
      display: flex; align-items: center; justify-content: center;
    }

    #toast {
      position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%) translateY(100%);
      background-color: var(--toast-info-bg); color: var(--toast-text); padding: 12px 24px;
      border-radius: 8px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      transition: transform 0.4s ease, opacity 0.4s ease; opacity: 0; z-index: 10000;
    }
    #toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
    #toast.info { background-color: var(--toast-info-bg); }
    #toast.success { background-color: var(--toast-success-bg); }
    #toast.error { background-color: var(--toast-error-bg); }
    #toast.warning { background-color: var(--toast-warning-bg); }

    .dark-toggle {
      position: fixed; top: 16px; right: 16px; background: none; border: 2px solid var(--text-color);
      border-radius: 50%; width: 36px; height: 36px; cursor: pointer; display: flex;
      align-items: center; justify-content: center; color: var(--text-color); font-size: 1rem;
      transition: background 0.3s ease, color 0.3s ease, border-color 0.3s ease; z-index: 1001;
    }
    .dark-toggle:hover { background-color: rgba(0, 0, 0, 0.1); }

    @media (max-width: 600px) {
      body { padding: 10px; }
      h1 { font-size: 1.5rem; margin-bottom: 16px; }
      #container { padding: 20px 12px; }
      #container.has-back { padding-top: 45px; }
      .start-btn, .quiz-btn { width: 100%; max-width: unset; font-size: 1rem; padding: 12px 0; }
      #btn-container { gap: 8px; }
      .dark-toggle { top: 8px; width: 32px; height: 32px; font-size: 0.9rem; }
    }

    #quizGenerator {
      display: none; width: 100%; max-width: 800px; margin-top: 20px; position: relative;
      background-color: var(--card-bg); border-radius: 12px; box-shadow: 0 8px 20px var(--card-shadow);
      padding: 30px 20px;
    }
    #quizGenerator textarea {
      width: 100%; height: 240px; resize: vertical; font-size: 16px; padding: 10px; margin-bottom: 10px;
      border-radius: 5px; border: 1px solid #ccc; background: #fff; white-space: pre-wrap;
      color: var(--text-color); background-color: var(--card-bg);
    }
    #quizGenerator .btn {
      display: inline-block; padding: 10px 20px; margin-bottom: 20px; background: #007bff; color: #fff;
      border: none; border-radius: 5px; cursor: pointer; font-size: 16px; text-align: center; transition: background 0.3s ease;
    }
    #quizGenerator .btn:hover { background: #0056b3; }
    #quizGenerator .question-container {
      background: var(--card-bg); border-radius: 8px; box-shadow: 0 2px 5px var(--card-shadow);
      padding: 20px; margin-bottom: 20px;
    }
    .template-buttons-container { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; justify-content: center; }
    .template-btn {
       padding: 8px 15px; border: none; border-radius: 5px; background-color: #6c757d; color: #fff;
       cursor: pointer; font-size: 0.9rem; transition: background 0.3s ease;
    }
    .template-btn:hover { background-color: #5a6268; }

    /* Global Material Buttons */
    .global-material-container {
      display: flex; justify-content: center; gap: 15px; margin-bottom: 25px; flex-wrap: wrap;
    }
    .global-material-btn {
      padding: 10px 20px; border: none; border-radius: 8px; font-size: 1rem; font-weight: 600;
      cursor: pointer; transition: background 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
      flex-grow: 1; max-width: 220px; color: #fff;
    }
    .global-material-btn.download-global {
      background: linear-gradient(135deg, #4CAF50 0%, #388E3C 100%);
      box-shadow: 0 4px 12px rgba(76, 175, 80, 0.4);
    }
    .global-material-btn.view-global {
      background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
      box-shadow: 0 4px 12px rgba(33, 150, 243, 0.4);
    }
  </style>
</head>
<body>
  <a href="#container" class="skip-link">Quiz-…ô ke√ß</a>

  <div id="loader">
    <div class="spinner"></div>
  </div>

  <button id="darkToggle" class="dark-toggle" aria-label="Dark rejimi d…ôyi≈üdir">üåô</button>
  <h1 id="headerTitle">Quiz M√∂vzularƒ±nƒ± Se√ßin</h1>
  <button id="quizLauncher" class="start-btn" style="margin-bottom: 20px;">Quiz Yarat</button>

  <div id="toast" role="alert" aria-live="assertive"></div>
  <div id="container"></div>

  <div class="lottie-wrapper" style="width: 100%; max-width: 400px; margin: 20px auto;">
    <dotlottie-player
      src="https://lottie.host/bcde77c2-384c-4857-a3ca-91a809ea95cf/LQ4RoKH5N7.lottie"
      background="transparent"
      speed="1"
      style="width: 100%; height: 300px;"
      loop
      autoplay
    ></dotlottie-player>
  </div>

  <div id="quizGenerator">
    <h1>Quiz Yarat</h1>
    <div class="template-buttons-container">
        <button class="template-btn" data-template="sample1">≈ûablon 1</button>
    </div>
    <textarea id="rawInput" placeholder="Suallarƒ±nƒ±zƒ± bura yapƒ±≈üdƒ±rƒ±n..."></textarea>
    <button id="parseQuiz" class="btn">Yarat</button>
    <button id="quizBackBtn" class="btn" style="background-color:#6c757d; margin-left:10px;">Geri</button>
    <div id="quiz"></div>
    <button id="submitQuiz" class="btn" style="display:none;">N…ôtic…ôni g√∂st…ôr</button>
    <div id="result" class="result"></div>
  </div>
  
  <audio id="clickSound"></audio>

  <script>
    // --- BU Hƒ∞SS∆è VACƒ∞BDƒ∞R: M…ôlumat Bazasƒ± ---
    // Buradakƒ± linkl…ôri v…ô adlarƒ± √∂z√ºn√ºz d…ôyi≈üdirm…ôlisiniz.
    const quizData = {
      program: {
        label: "Proqramla≈üdƒ±rma",
        globalDownloadLink: "https://example.com/program-pdf",
        globalViewLink: "https://example.com/program-view",
        quizzes: [
            { label: "Sual 1-10", link: "https://example.com/quiz1" },
            { label: "Sual 11-20", link: "https://example.com/quiz2" }
        ]
      },
      instr: {
        label: "ƒ∞nstrumental v…ô t…ôtbiqi proqramlar",
        quizzes: [
            { label: "√úmumi Sƒ±naq", link: "https://example.com/instr-quiz" }
        ]
      },
      linear: {
        label: "X…ôtti C…ôbr",
        quizzes: [{ label: "Matrisl…ôr", link: "https://example.com/linear" }]
      },
      xdiak: {
        label: "XDIAK",
        quizzes: [{ label: "Sƒ±naq", link: "https://example.com/xdiak" }]
      },
      it: {
        label: "ƒ∞T ∆èsaslarƒ± 2",
        quizzes: [{ label: "≈û…ôb…ôk…ôl…ôr", link: "https://example.com/it" }]
      },
      fizika: {
        label: "Fizika",
        quizzes: [{ label: "Mexanika", link: "https://example.com/fizika" }]
      },
      diff: {
        label: "Diferensial",
        quizzes: [{ label: "T√∂r…ôm…ô", link: "https://example.com/diff" }]
      }
    };

    const quizTemplates = {
        sample1: "1. Sual n√ºmun…ôsi?\nA). Cavab A\nB). Cavab B\n"
    };

    // --- IP Konfiqurasiyasƒ± ---
    const allowedIPPrefixes = [
      "37.114.", "45.15.", "188.253.", "82.194.",
      "185.146.", "94.20.", "149.126.", "37.26.", "62.217.","109.239.","37.61.","5.191."
    ];
    let userAllowed = true; // Test √º√ß√ºn TRUE etdim. Real i≈üd…ô checkIP funksiyasƒ±na buraxƒ±n.
    
    // D…ôyi≈ü…ônl…ôr
    const container = document.getElementById("container");
    const toast = document.getElementById("toast");
    const loader = document.getElementById("loader");
    const clickAudio = document.getElementById("clickSound");
    const toggleBtn = document.getElementById("darkToggle");
    const headerTitle = document.getElementById("headerTitle");
    const quizLauncher = document.getElementById("quizLauncher");
    const quizGenerator = document.getElementById("quizGenerator");
    const quizBackBtn = document.getElementById("quizBackBtn");
    const rawInput = document.getElementById("rawInput"); 
    const isiOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;

    // Effektl…ôr
    function addRippleEffect(btn) {
      btn.addEventListener("click", function (e) {
        const rect = btn.getBoundingClientRect();
        const circle = document.createElement("span");
        const size = Math.max(rect.width, rect.height);
        const x = e.clientX - rect.left - size / 2;
        const y = e.clientY - rect.top - size / 2;
        circle.style.width = circle.style.height = size + "px";
        circle.style.left = x + "px";
        circle.style.top = y + "px";
        circle.classList.add("ripple");
        const ripple = btn.getElementsByClassName("ripple")[0];
        if (ripple) ripple.remove();
        btn.appendChild(circle);
      });
      btn.addEventListener("click", () => {
        if(clickAudio && clickAudio.src) {
            clickAudio.currentTime = 0;
            clickAudio.play().catch(e => console.log(e));
        }
      });
    }

    function attachButtonEffects() {
      document.querySelectorAll("button").forEach((button) => {
        addRippleEffect(button);
      });
    }

    function showToast(message, type = "info") {
      toast.textContent = message;
      toast.className = "";
      toast.classList.add("show", type);
      setTimeout(() => {
        toast.classList.remove("show", type);
      }, 3000);
    }

    function renderMainMenu() {
      quizGenerator.style.display = "none";
      headerTitle.textContent = "Quiz M√∂vzularƒ±nƒ± Se√ßin";
      container.classList.remove("has-back", "hidden");
      container.innerHTML =
        '<p class="section-title">Ba≈ülanƒüƒ±c m√∂vzu:</p>' +
        '<button class="start-btn" data-topic="program">Proqramla≈üdƒ±rma</button>' +
        '<button class="start-btn" data-topic="instr">ƒ∞nstrumental v…ô t…ôtbiqi proqramlar</button>' +
        '<button class="start-btn" data-topic="linear">X…ôtti C…ôbr</button>' +
        '<button class="start-btn" data-topic="xdiak">XDIAK</button>' +
        '<button class="start-btn" data-topic="it">ƒ∞T ∆èsaslarƒ± 2</button>' +
        '<button class="start-btn" data-topic="fizika">Fizika</button>' +
        '<button class="start-btn" data-topic="diff">Diferensial</button>';
      attachButtonEffects();
      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    function startQuiz(topic) {
      // ∆èg…ôr baza yoxdursa, x…ôta verm…ôsin
      if (!quizData[topic]) {
          showToast("Bu m√∂vzu √º√ß√ºn m…ôlumat tapƒ±lmadƒ±", "error");
          return;
      }

      if (!userAllowed) {
          showToast("ƒ∞caz…ôsiz giri≈ü!", "error");
          return;
      }
      localStorage.setItem("lastTopic", topic);

      container.classList.add("hidden");
      setTimeout(() => {
        container.classList.remove("hidden");
        container.classList.add("has-back");
        
        const topicData = quizData[topic];
        headerTitle.textContent = topicData.label + " suallarƒ±nƒ± se√ß:";
        
        const globalMaterialContainer = document.createElement("div");
        globalMaterialContainer.className = "global-material-container";

        if (topicData.globalDownloadLink) {
          const downloadBtn = document.createElement("button");
          downloadBtn.className = "global-material-btn download-global";
          downloadBtn.textContent = "D…ôrs Materiallarƒ±nƒ± Y√ºkl…ô";
          downloadBtn.onclick = () => {
            window.open(topicData.globalDownloadLink, "_blank");
          };
          globalMaterialContainer.appendChild(downloadBtn);
        }

        if (topicData.globalViewLink) {
          const viewBtn = document.createElement("button");
          viewBtn.className = "global-material-btn view-global";
          viewBtn.textContent = "D…ôrs Materiallarƒ±na Online Bax";
          viewBtn.onclick = () => {
            window.open(topicData.globalViewLink, "_blank");
          };
          globalMaterialContainer.appendChild(viewBtn);
        }

        container.innerHTML =
          '<button class="back-btn" aria-label="‚Äπ Geri">‚Äπ Geri</button>' +
          '<p class="section-title"></p>';
        
        if (globalMaterialContainer.children.length > 0) {
          container.appendChild(globalMaterialContainer);
        }

        const btnContainer = document.createElement("div");
        btnContainer.id = "btn-container";

        if(topicData.quizzes) {
            topicData.quizzes.forEach((item) => { 
            const quizBtn = document.createElement("button");
            quizBtn.className = "quiz-btn";
            quizBtn.textContent = item.label;
            quizBtn.setAttribute("data-link", item.link);
            btnContainer.appendChild(quizBtn);
            });
        }
        container.appendChild(btnContainer);

        setTimeout(() => container.classList.remove("hidden"), 50);
        attachButtonEffects(); 
      }, 300);
    }

    function openQuiz(link, btn) {
      btn.classList.add("btn-loading");
      if (isiOS) {
        const existingModal = document.getElementById("modal-overlay");
        if (existingModal) existingModal.remove();

        const overlay = document.createElement("div");
        overlay.id = "modal-overlay";
        overlay.className = "modal-overlay";

        const modal = document.createElement("div");
        modal.className = "modal-content";

        const closeBtn = document.createElement("button");
        closeBtn.className = "close-modal";
        closeBtn.innerHTML = "‚úï";
        closeBtn.onclick = () => {
          document.body.removeChild(overlay);
        };

        const iframe = document.createElement("iframe");
        iframe.src = link;
        iframe.allow = "fullscreen";
        
        modal.appendChild(closeBtn);
        modal.appendChild(iframe);
        overlay.appendChild(modal);
        document.body.appendChild(overlay);
        btn.classList.remove("btn-loading");
      } else {
        const existingIframe = document.getElementById("fullscreen-quiz");
        if (existingIframe) existingIframe.remove();

        const iframe = document.createElement("iframe");
        iframe.src = link;
        iframe.id = "fullscreen-quiz";
        iframe.className = "fullscreen-quiz";
        iframe.allow = "fullscreen";
        iframe.allowFullscreen = true;
        document.body.appendChild(iframe);

        iframe.onload = () => {
          btn.classList.remove("btn-loading");
        };

        if (iframe.requestFullscreen) iframe.requestFullscreen();
        else if (iframe.webkitRequestFullscreen) iframe.webkitRequestFullscreen();
        
        const handleExit = () => {
            if (!document.fullscreenElement) {
                const frame = document.getElementById("fullscreen-quiz");
                if(frame) frame.remove();
                document.removeEventListener("fullscreenchange", handleExit);
            }
        };
        document.addEventListener("fullscreenchange", handleExit);
      }
    }

    async function checkIP() {
      try {
        const res = await fetch("https://api.ipify.org?format=json");
        const data = await res.json();
        const userIP = data.ip;
        const matches = allowedIPPrefixes.some((prefix) => userIP.startsWith(prefix));
        
        // Test √º√ß√ºn bu hiss…ôni ≈ü…ôrh…ô salƒ±ram ki, kodunuz i≈ül…ôsin. 
        // Real istifad…ô √º√ß√ºn a≈üaƒüƒ±dakƒ± s…ôtiri aktivl…ô≈üdirin:
        // userAllowed = matches;

        if (!userAllowed) {
          container.style.display = "none";
          showToast("Sizin IP icaz…ôli deyil!", "error");
        }
      } catch (err) {
        console.error("IP Check X…ôtasƒ±:", err);
      }
    }

    function initializeTheme() {
      const currentMode = localStorage.getItem("theme");
      if (currentMode === "dark") {
        document.body.classList.add("dark");
        toggleBtn.textContent = "‚òÄÔ∏è";
      } else {
        toggleBtn.textContent = "üåô";
      }
      toggleBtn.addEventListener("click", () => {
        document.body.classList.toggle("dark");
        if (document.body.classList.contains("dark")) {
          localStorage.setItem("theme", "dark");
          toggleBtn.textContent = "‚òÄÔ∏è";
        } else {
          localStorage.setItem("theme", "light");
          toggleBtn.textContent = "üåô";
        }
      });
    }

    function initializeLoader() {
      window.addEventListener("load", () => {
        loader.classList.add("hidden");
        setTimeout(() => (loader.style.display = "none"), 300);
      });
    }

    document.addEventListener("DOMContentLoaded", () => {
      initializeTheme();
      initializeLoader();
      renderMainMenu();

      // Event Delegation for dynamic buttons
      container.addEventListener("click", (e) => {
        const btn = e.target.closest("button");
        if (!btn) return;

        if (btn.classList.contains("start-btn") && btn.id !== "quizLauncher") {
            const topic = btn.getAttribute("data-topic");
            startQuiz(topic);
        } 
        else if (btn.classList.contains("back-btn")) {
            renderMainMenu();
        } 
        else if (btn.classList.contains("quiz-btn")) {
            const link = btn.getAttribute("data-link");
            if (link) openQuiz(link, btn);
        }
      });

      const lastTopic = localStorage.getItem("lastTopic");
      if (lastTopic && quizData[lastTopic]) {
        setTimeout(() => startQuiz(lastTopic), 800);
      }

      quizLauncher.addEventListener("click", () => {
        container.classList.add("hidden");
        headerTitle.textContent = "Quiz Yarat";
        quizGenerator.style.display = "block";
        quizGenerator.scrollIntoView({ behavior: "smooth", block: "start" });
      });

      quizBackBtn.addEventListener("click", (e) => {
        e.preventDefault();
        renderMainMenu();
        rawInput.value = "";
        document.getElementById("quiz").innerHTML = "";
        document.getElementById("result").textContent = "";
        document.getElementById("submitQuiz").style.display = "none";
      });

      document.querySelectorAll(".template-btn").forEach(button => {
          button.addEventListener("click", (e) => {
              const templateName = e.target.dataset.template;
              if (quizTemplates[templateName]) {
                  rawInput.value = quizTemplates[templateName];
              }
          });
      });
    });

    window.addEventListener("load", checkIP);
  </script>
</body>
</html>
